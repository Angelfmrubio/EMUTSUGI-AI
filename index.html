<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="EMUTSUGI - GRIETAS DORADAS CON PROP√ìSITO" />
  <meta name="robots" content="noindex, nofollow" />
  <title>EMUTSUGI ‚Äî Grietas Doradas</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --clr-gold-light: hsl(45, 93%, 65%);
      --clr-copper: hsl(25, 55%, 50%);
      --clr-dark-deep: hsl(220, 15%, 10%);
      --clr-text-light: hsl(0, 0%, 95%);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* ‚úÖ IMAGEN SOLO AQU√ç - EN EL BODY */
    body {
      font-family: Georgia, serif;
      color: var(--clr-text-light);
      background: linear-gradient(rgba(18, 18, 18, 0.9), rgba(18, 18, 18, 0.95)), 
                  url('portada-emutsugi.jpg') no-repeat center center / cover fixed;
      min-height: 100vh;
      overflow-x: hidden;
      background-blend-mode: multiply; /* Evita superposiciones */
    }

    .session-bar {
      position: fixed;
      top: 0; right: 0;
      padding: 1rem;
      z-index: 100;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .session-btn {
      font-family: Georgia, serif;
      padding: 0.5rem 1rem;
      background: rgba(26, 26, 26, 0.8);
      border: 1px solid var(--clr-gold-light);
      color: var(--clr-text-light);
      cursor: pointer;
      border-radius: 4px;
      font-weight: 600;
      transition: var(--transition);
    }

    .session-btn:hover {
      background: var(--clr-gold-light);
      color: var(--clr-dark-deep);
    }

    .user-info {
      color: var(--clr-gold-light);
      font-weight: 600;
      margin-right: 1rem;
    }

    /* ‚úÖ PORTADA SIN FONDO - usa el del body */
    .portada {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
      background: transparent !important; /* FORZADO transparente */
      backdrop-filter: blur(10px);
      text-align: center;
      position: relative; /* Para asegurar stacking */
    }

    .universo {
      font-size: clamp(1rem, 3vw, 1.5rem);
      font-family: 'Cinzel', serif;
      color: var(--clr-gold-light);
      letter-spacing: 8px;
      opacity: 0.8;
      margin-bottom: 0.5rem;
    }

    .emutsugi {
      font-size: clamp(3rem, 12vw, 8rem);
      font-family: 'Cinzel', serif;
      font-weight: 700;
      background: linear-gradient(180deg, var(--clr-gold-light), var(--clr-copper));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 0 25px rgba(218, 165, 32, 0.7));
      letter-spacing: 5px;
      line-height: 1;
    }

    .subtitulo {
      font-size: clamp(0.9rem, 2.5vw, 1.3rem);
      font-family: 'Cinzel', serif;
      color: var(--clr-copper);
      letter-spacing: 4px;
      margin: 1.5rem 0;
      text-transform: uppercase;
    }

    .frase {
      font-family: Georgia, serif;
      font-size: clamp(1rem, 2.5vw, 1.3rem);
      margin: 2rem auto;
      max-width: 700px;
      line-height: 1.7;
      text-wrap: balance;
    }

    .botones-container {
      display: flex;
      gap: 1.5rem;
      margin-top: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      font-family: Georgia, serif;
      display: inline-block;
      background: rgba(26, 26, 26, 0.6);
      border: 2px solid var(--clr-gold-light);
      color: var(--clr-text-light);
      padding: 16px 36px;
      text-decoration: none;
      font-weight: 700;
      font-size: 0.95rem;
      border-radius: 8px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }

    .btn:hover::before { left: 100%; }

    .btn:hover {
      background: linear-gradient(90deg, var(--clr-copper), var(--clr-gold-light));
      color: var(--clr-dark-deep);
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(218, 165, 32, 0.4);
      border-color: transparent;
    }

    .btn-principal {
      background: linear-gradient(90deg, var(--clr-copper), var(--clr-gold-light));
      color: var(--clr-dark-deep);
    }

    .btn-principal:hover {
      filter: brightness(1.1);
    }

    .diagnosticos {
      background: linear-gradient(to bottom, #111, var(--clr-dark-deep));
      padding: 80px 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .diagnosticos h2 {
      font-family: 'Cinzel', serif;
      color: var(--clr-gold-light);
      margin-bottom: 2rem;
      text-align: center;
      font-size: 2.5rem;
    }

    #lista-diagnosticos { list-style: none; padding: 0; }

    .diagnostico-item {
      background: rgba(255, 255, 255, 0.05);
      margin: 1rem 0;
      padding: 1.5rem;
      border-left: 4px solid var(--clr-copper);
      border-radius: 8px;
      transition: var(--transition);
      backdrop-filter: blur(5px);
    }

    .diagnostico-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(5px);
      border-left-color: var(--clr-gold-light);
    }

    .fecha {
      font-family: Georgia, serif;
      color: var(--clr-gold-light);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .estado {
      font-family: Georgia, serif;
      margin-top: 0.5rem;
      line-height: 1.7;
    }

    .loading {
      font-family: Georgia, serif;
      text-align: center;
      padding: 2rem;
      color: var(--clr-copper);
    }

    .error {
      font-family: Georgia, serif;
      color: #ff6b6b;
      padding: 1rem;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 8px;
      border-left: 4px solid #ff6b6b;
    }

    .empty {
      font-family: Georgia, serif;
      text-align: center;
      padding: 3rem;
      color: var(--clr-copper);
      font-style: italic;
    }

    @media (max-width: 768px) {
      .session-bar {
        top: auto; bottom: 0; left: 0; right: 0;
        background: rgba(18, 18, 18, 0.95);
        padding: 0.75rem;
        justify-content: center;
      }
      
      .user-info {
        margin-right: auto;
        font-size: 0.85rem;
      }

      .botones-container {
        flex-direction: column;
        width: 100%;
        max-width: 300px;
      }

      .btn {
        width: 100%;
      }

      /* FIX m√≥vil: desactiva fixed para mejor rendimiento */
      body {
        background-attachment: scroll;
      }
    }
  </style>
</head>
<body>
  <!-- Barra de Sesi√≥n -->
  <div class="session-bar" id="session-bar" style="display: none;">
    <span class="user-info" id="user-email"></span>
    <button class="session-btn" id="logout-btn">Cerrar Sesi√≥n</button>
  </div>

  <!-- PORTADA -->
  <section class="portada" id="portada">
    <div class="universo">UNIVERSO</div>
    <h1 class="emutsugi">EMUTSUGI</h1>
    <div class="subtitulo">Grietas Doradas Con Prop√≥sito</div>
    <p class="frase">
      Transmuta tu sombra, decodifica tu presente,<br>
      hereda tu legado dorado. <strong>Brilla.</strong>
    </p>
    <div class="botones-container" id="auth-buttons">
      <a href="#diagnosticos" class="btn btn-principal">INICIAR TRANSFORMACI√ìN</a>
      <a href="#principios" class="btn">EXPLORAR PRINCIPIOS</a>
    </div>
  </section>

  <!-- SECCI√ìN DIAGN√ìSTICOS -->
  <section id="diagnosticos" class="diagnosticos">
    <div class="container">
      <h2>Mis Diagn√≥sticos</h2>
      <ul id="lista-diagnosticos" class="loading">Verificando sesi√≥n...</ul>
    </div>
  </section>

  <!-- SECCI√ìN PRINCIPIOS -->
  <section id="principios" class="diagnosticos">
    <div class="container">
      <h2>Principios</h2>
      <p style="text-align: center; color: var(--clr-copper); padding: 2rem;">
        Contenido de principios en desarrollo...
      </p>
    </div>
  </section>

  <script type="module">
    // ‚úÖ CORREGIDO: URLs sin espacios
    const SUPABASE_URL = 'https://vkqqhuvhcndqmypdkrgj.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_at9xQvuR1uX1DD18CJoBNQ_VqWz_Y6z';
    
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const lista = document.getElementById('lista-diagnosticos');
    const sessionBar = document.getElementById('session-bar');
    const userEmail = document.getElementById('user-email');
    const logoutBtn = document.getElementById('logout-btn');
    
    function mostrarError(mensaje) {
      lista.innerHTML = `<li class="error">‚ö†Ô∏è ${mensaje}</li>`;
      console.error('Error EMUTSUGI:', mensaje);
    }

    function formatearFecha(fecha) {
      if (!fecha) return 'Sin fecha';
      return new Date(fecha).toLocaleDateString('es-ES', {
        year: 'numeric', month: 'long', day: 'numeric'
      });
    }

    logoutBtn?.addEventListener('click', async () => {
      try {
        await supabase.auth.signOut();
        window.location.reload();
      } catch (error) {
        mostrarError('Error al cerrar sesi√≥n');
      }
    });

    async function inicializarApp() {
      try {
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        
        if (sessionError) throw sessionError;

        if (session?.user) {
          sessionBar.style.display = 'flex';
          userEmail.textContent = session.user.email;
          await cargarDiagnosticos(session.user.id);
        } else {
          sessionBar.style.display = 'none';
          lista.innerHTML = `
            <li class="empty">
              üîê No hay sesi√≥n activa.<br>
              <a href="${SUPABASE_URL}/auth/v1/login" class="btn" style="margin-top: 1rem;">
                Iniciar Sesi√≥n
              </a>
            </li>
          `;
        }
      } catch (error) {
        mostrarError(`Error de conexi√≥n: ${error.message}`);
      }
    }

    async function cargarDiagnosticos(userId) {
      try {
        lista.innerHTML = '<li class="loading">‚è≥ Cargando diagn√≥sticos...</li>';

        const { data, error } = await supabase
          .from('diagnosticos_diarios')
          .select('*')
          .eq('usuario_id', userId)
          .order('fecha', { ascending: false });

        if (error) throw error;

        if (!data || data.length === 0) {
          lista.innerHTML = `
            <li class="empty">
              üìä No se encontraron diagn√≥sticos.<br>
              <small>Crea tu primer diagn√≥stico para verlo aqu√≠.</small>
            </li>
          `;
          return;
        }

        lista.innerHTML = '';
        data.forEach(diagnostico => {
          const item = document.createElement('li');
          item.className = 'diagnostico-item';
          item.innerHTML = `
            <div class="fecha">${formatearFecha(diagnostico.fecha)}</div>
            <div class="estado">${diagnostico.estado || 'Sin estado'}</div>
          `;
          lista.appendChild(item);
        });
      } catch (error) {
        mostrarError(`Error al cargar datos: ${error.message}`);
      }
    }

    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_OUT') {
        window.location.reload();
      } else if (event === 'SIGNED_IN') {
        cargarDiagnosticos(session.user.id);
        sessionBar.style.display = 'flex';
        userEmail.textContent = session.user.email;
      }
    });

    inicializarApp();
  </script>
</body>
</html>